<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <script src="http://cdn.peerjs.com/0.3/peer.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css"/>
        <script type="text/javascript">
        $(document).ready(function(){
           var peer = new Peer('ractor', {key: '59q78rz8h3rkvs4i'});
	         var audiopeer = new Peer('ractorAudio', {key: 'v8xnu3rgrm3x47vi'});
           var conn = peer.connect('student');
	       conn.on('open', function(){
  		        conn.send('Handshake: Hi, I am ractor ');
	       });
	   //Data Channel
	       peer.on('connection', function(conn) {
  		    conn.on('data', function(data){
    	// Receive info from student
    	   console.log(data);
            });
	       });
	var image = {
		//List out all images here and send urls accordingly
    1:'http://bit.ly/1CJVOsI',
		2:'http://bit.ly/1Cf1drk'
	}

  	navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia);


        $('#call_button').click( function(){
            $('#calling').show();
            navigator.getUserMedia(
  			{video: true, audio: true},
 			  function(localAudioStream) {
    			//call student
    			var outgoing = audiopeer.call("studentAudio", localAudioStream);
    			//in student answering call
    			outgoing.on('stream', function(stream) {
		              $('#calling').hide();
                      $('#connected').show();
  					playStream(stream);
				});

  			},
  			function error(err) {
    			console.log(err);
  			}
		);

        });
        $('.page-preview').click(function(){
            var img=$(this).attr('src');
            $('#second_strip').html('<img class="pageDisp" id="currentPage" src="'+img+'" width="400px" height="600px" />');
            console.log(img);
            conn.send(img);
        });
    })
        </script>
        <script type="text/javascript">


	//in case student calls first
	/*
    audiopeer.on('call', function(incoming) {
  			incoming.on('stream', function(stream) {
    			playStream(stream);
  			});
	});
	*/
	function playStream(stream) {
 		 var audio = $('<video autoplay />').appendTo('body');
  			audio[0].src = (URL || webkitURL || mozURL).createObjectURL(stream);
	}
</script>
    </head>
    <body>
        <div class="main-box" id="first_strip">
            <div id="call_box">
                <img id="call_butt" src="call.png" width="30px" height="30px" style="cursor: pointer;" />
                <input type ="button" id="call_button" value="Call"/>
                <span id="calling" style="display :none; border: 1px solid black; hidden" > call connecting....</span>
                <span id="connected" style="display :none;"> call connected....</span>
            </div>
            <div id="images">

       </div>

            </div>
        </div>
        <div class="main-box" id="second_strip">
         </div>
        <div class="main-box" id="third_strip">
        story pages: <br />
         <ol id="images">
            <li><img class="page-preview" id="misc1" src="http://i.imgur.com/s1WtC6T.png" /></li>
            <li><img class="page-preview" id="misc2" src="http://i.imgur.com/iR0HbUX.png" /></li>
            <li><img class="page-preview" id="misc3" src="http://i.imgur.com/uOwdQEy.png" /></li>
            <li><img class="page-preview" id="misc3" src="http://i.imgur.com/3yLm8da.png" /></li>
            <li><img class="page-preview" id="misc3" src="http://i.imgur.com/gEH27hP.png" /></li>
         </ol>

        </div>

    </body>



</html>
